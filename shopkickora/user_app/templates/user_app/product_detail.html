{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shopKickora - {{ product.name|default:"Product" }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        
        .size-box {
            transition: all 0.2s ease;
        }
        
        .size-box.selected {
            background-color: #1a202c;
            color: white;
        }
        
        .img-zoom-container {
            position: relative;
            display: inline-block;
            border: 1px solid #d4d4d4;
            background-color: #f9fafb;
            padding: 1rem;
            height: 480px;
            width: 550px;
            overflow: hidden;
        }

        .img-zoom-lens {
            position: absolute;
            border: 1px solid #d4d4d4;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.3);
            cursor: none;
            z-index: 10;
            display: none;
        }

        .img-zoom-result {
            position: absolute;
            top: 0;
            left: 105%;
            border: 1px solid #d4d4d4;
            width: 700px;
            height: 550px;
            background-repeat: no-repeat;
            background-color: #fff;
            z-index: 100;
            display: none;
        }

        #mainImage {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .thumbnail {
    width: 80px;
    height: 80px;
    object-fit: cover; /* Changed from contain to cover for better fit */
    border: 1px solid #d4d4d4;
    padding: 4px;
    cursor: pointer;
    transition: border-color 0.2s ease;
    border-radius: 4px; /* Optional: slight rounding for aesthetics */
}

.thumbnail:hover {
    border-color: #1a202c;
}

.thumbnail.active {
    border-color: #1a202c;
    background-color: #f1f5f9;
}

/* Ensure the thumbnail container aligns with the main image */
.w-\[550px\] {
    width: 550px;
}
        
    </style>
</head>
<body class="bg-white">
    

    <header class="border-b border-gray-200">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-8">
                <a href="{% url 'user_dashboard' %}" class="text-2xl font-bold">shopKickora</a>
                <nav class="hidden md:flex space-x-6">
                    <a href="{% url 'user_dashboard' %}" class="text-sm hover:text-gray-500">Home</a>
                    <div class="relative group">
                        <a href="{% url 'user_product_list' %}" class="text-sm hover:text-gray-500 flex items-center">
                            Categories <i class="fas fa-chevron-down ml-1 text-xs"></i>
                        </a>
                    </div>
                    <a href="{% url 'user_product_list' %}" class="text-sm hover:text-gray-500 flex items-center">
                        Explore All <i class="fas fa-chevron-down ml-1 text-xs"></i>
                    </a>
                    <a href="#" class="text-sm hover:text-gray-500">About</a>
                    <a href="#" class="text-sm hover:text-gray-500">Contact</a>
                </nav>
            </div>
            <div class="flex items-center space-x-4">
                <form action="{% url 'user_product_list' %}" method="GET" class="relative hidden md:block">
                    <input type="text" name="q" placeholder="Search products" class="border border-gray-300 rounded-md pl-8 pr-4 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-gray-500">
                    <i class="fas fa-search absolute left-3 top-2 text-gray-400 text-sm"></i>
                </form>
                <a href="#" class="text-gray-700 hover:text-gray-900 relative">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="absolute -top-2 -right-2 bg-gray-900 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                </a>
                <a href="#" class="text-gray-700 hover:text-gray-900">
                    <i class="fas fa-user"></i>
                </a>
                <button class="md:hidden" id="mobile-menu-btn">
                    <i class="fas fa-bars text-gray-700"></i>
                </button>
            </div>
        </div>
        <nav class="md:hidden hidden pb-4 px-4" id="mobile-menu">
            <div class="flex flex-col space-y-2">
                <a href="{% url 'user_dashboard' %}" class="text-sm hover:text-gray-500 py-2">Home</a>
                <a href="{% url 'user_product_list' %}" class="text-sm hover:text-gray-500 py-2">Categories</a>
                <a href="{% url 'user_product_list' %}" class="text-sm hover:text-gray-500 py-2">Explore All</a>
                <a href="#" class="text-sm hover:text-gray-500 py-2">About</a>
                <a href="#" class="text-sm hover:text-gray-500 py-2">Contact</a>
            </div>
        </nav>
    </header>

    <div class="container mx-auto px-4 py-2">
        <div class="flex text-xs text-gray-500">
            <a href="{% url 'user_dashboard' %}" class="hover:underline">Home</a>
            <span class="mx-2">/</span>
            <a href="{% url 'user_product_list' %}" class="hover:underline">Products</a>
            <span class="mx-2">/</span>
            <span>{{ product.name|default:"Product" }}</span>
        </div>
    </div>

    <main class="container mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-4 relative">
    <div class="img-zoom-container">
        <img id="mainImage" src="{% if product.images.all %}{{ product.images.all.0.image.url }}{% elif product.image %}{{ product.image.url }}{% else %}{% static 'user_app/default-shoe.jpg' %}{% endif %}" alt="{{ product.name|default:'Product' }}">
    </div>
    {% if product.images.all %}
        <div class="flex justify-center space-x-2 mt-2 w-[550px] mx-auto">
            {% for image in product.images.all|slice:":3" %}
                <img src="{{ image.image.url }}" alt="{{ product.name|default:'Product' }} thumbnail" class="thumbnail {% if forloop.first %}active{% endif %}" onclick="changeImage('{{ image.image.url }}', this)">
            {% endfor %}
        </div>
    {% endif %}
    <div id="myresult" class="img-zoom-result"></div>
</div>

            <div>
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <div class="flex text-yellow-400 mr-2">
                            {% for i in "12345" %}
                                <i class="fas fa-star {% if forloop.counter <= product.rating|default:4 %}text-yellow-400{% else %}text-gray-300{% endif %}"></i>
                            {% endfor %}
                        </div>
                        <span class="text-sm text-gray-500">{{ product.reviews_count|default:"0" }} reviews</span>
                    </div>
                    <button class="text-gray-500 hover:text-gray-900">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>

                <h1 class="text-2xl font-bold mb-2">{{ product.name|default:"Product" }}</h1>
                <p class="text-2xl font-bold mb-6">{{ product.price|default:"0.00" }}</p>

                <div class="mb-6">
                    <h3 class="text-sm font-medium mb-2">AVAILABLE TYPES</h3>
                    <div class="flex space-x-2">
                        <button class="px-4 py-1 border border-gray-300 rounded text-sm bg-gray-100">Men</button>
                    </div>
                </div>

                <div class="mb-6">
                    <h3 class="text-sm font-medium mb-2">SELECT SIZE</h3>
                    <div class="grid grid-cols-5 gap-2">
                        {% for size in sizes %}
                            <button class="size-box border border-gray-300 rounded text-center py-2 hover:border-gray-900 {% if selected_size == size %}selected{% endif %}" data-size="{{ size }}">{{ size }}</button>
                        {% endfor %}
                    </div>
                    <input type="hidden" id="selected-size" value="{{ selected_size|default_if_none:'' }}">
                </div>

                <div class="mb-6">
                    <h3 class="text-sm font-medium mb-2">QUANTITY</h3>
                    <div class="flex items-center border border-gray-300 rounded w-max">
                        <button id="decreaseBtn" class="px-3 py-1 text-lg" onclick="decreaseQuantity()">−</button>
                        <input id="quantity" type="text" value="1" class="w-8 text-center focus:outline-none" readonly>
                        <button id="increaseBtn" class="px-3 py-1 text-lg" onclick="increaseQuantity()">+</button>
                    </div>
                </div>

                <div class="flex space-x-4 mb-4">
                    <form action="" method="POST" class="w-full">
                        {% csrf_token %}
                        <input type="hidden" name="size" id="cart-size" value="{{ selected_size|default_if_none:'' }}">
                        <input type="hidden" name="quantity" id="cart-quantity" value="1">
                        <button type="submit" id="addToCartBtn" class="bg-gray-900 text-white py-3 px-6 rounded hover:bg-gray-800 w-full" {% if not selected_size %}disabled{% endif %}>ADD TO CART</button>
                    </form>
                    <button class="border border-gray-300 p-3 rounded hover:bg-gray-50">
                        <i class="far fa-heart"></i>
                    </button>
                </div>

            </div>
        </div>

        <div class="mt-16 border-t border-gray-200 pt-8">
            <div class="flex border-b border-gray-200">
                <span class="text-sm font-medium pb-4 border-b-2 border-gray-900 mr-8">Details</span>
            </div>

            <div class="py-8">
                <p class="text-gray-700 mb-4">{{ product.description|default:"No description available." }}</p>
            </div>
        </div>
    </main>

    <footer class="bg-gray-100 mt-16 pt-12 pb-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <h3 class="font-bold text-lg mb-4">shopKickora</h3>
                    <p class="text-gray-600 text-sm">The best place to find premium footwear for all your needs.</p>
                </div>
                <div>
                    <h4 class="font-medium mb-4">Shop</h4>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li><a href="{% url 'user_product_list' %}?category=men" class="hover:text-gray-900">Men's Shoes</a></li>
                        <li><a href="{% url 'user_product_list' %}?category=women" class="hover:text-gray-900">Women's Shoes</a></li>
                        <li><a href="{% url 'user_product_list' %}?category=kids" class="hover:text-gray-900">Kids' Shoes</a></li>
                        <li><a href="{% url 'user_product_list' %}?sort=newest" class="hover:text-gray-900">New Arrivals</a></li>
                        <li><a href="{% url 'user_product_list' %}?sort=sale" class="hover:text-gray-900">Sale</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-medium mb-4">Company</h4>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li><a href="#" class="hover:text-gray-900">About Us</a></li>
                        <li><a href="#" class="hover:text-gray-900">Careers</a></li>
                        <li><a href="#" class="hover:text-gray-900">Contact</a></li>
                        <li><a href="#" class="hover:text-gray-900">Blog</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-medium mb-4">Customer Service</h4>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li><a href="#" class="hover:text-gray-900">Help Center</a></li>
                        <li><a href="#" class="hover:text-gray-900">Shipping & Returns</a></li>
                        <li><a href="#" class="hover:text-gray-900">Size Guide</a></li>
                        <li><a href="#" class="hover:text-gray-900">FAQ</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-200 pt-8 flex flex-col md:flex-row justify-between items-center">
                <p class="text-sm text-gray-500 mb-4 md:mb-0">© 2025 shopKickora. All rights reserved.</p>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-500 hover:text-gray-900"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-gray-500 hover:text-gray-900"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-gray-500 hover:text-gray-900"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="text-gray-500 hover:text-gray-900"><i class="fab fa-pinterest"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Image Zoom Functionality
        function imageZoom(imgID, resultID) {
            const img = document.getElementById(imgID);
            const result = document.getElementById(resultID);

            // Remove any existing lens to prevent duplicates
            let existingLens = img.parentElement.querySelector('.img-zoom-lens');
            if (existingLens) {
                existingLens.remove();
            }

            // Create lens
            const lens = document.createElement("DIV");
            lens.setAttribute("class", "img-zoom-lens");
            img.parentElement.insertBefore(lens, img);

            let cx, cy;

            // Function to calculate and update zoom ratios and background size
            function updateZoomRatios() {
                if (img.naturalWidth === 0) {
                    img.onload = () => {
                        cx = result.offsetWidth / lens.offsetWidth;
                        cy = result.offsetHeight / lens.offsetHeight;
                        result.style.backgroundImage = `url('${img.src}')`;
                        result.style.backgroundSize = `${img.naturalWidth * cx}px ${img.naturalHeight * cy}px`;
                    };
                    return;
                }

                cx = result.offsetWidth / lens.offsetWidth;
                cy = result.offsetHeight / lens.offsetHeight;
                result.style.backgroundImage = `url('${img.src}')`;
                result.style.backgroundSize = `${img.naturalWidth * cx}px ${img.naturalHeight * cy}px`;
            }

            // Initial call to set ratios and background
            updateZoomRatios();

            // Named functions for event listeners
            function handleMouseMove(e) {
                e.preventDefault();
                const pos = getCursorPos(e);
                let x = pos.x - (lens.offsetWidth / 2);
                let y = pos.y - (lens.offsetHeight / 2);

                x = Math.max(0, Math.min(x, img.offsetWidth - lens.offsetWidth));
                y = Math.max(0, Math.min(y, img.offsetHeight - lens.offsetHeight));

                lens.style.left = x + "px";
                lens.style.top = y + "px";

                result.style.backgroundPosition = `-${x * cx}px -${y * cy}px`;
            }

            function handleMouseEnter() {
                lens.style.display = 'block';
                result.style.display = 'block';
                updateZoomRatios();
            }

            function handleMouseLeave() {
                lens.style.display = 'none';
                result.style.display = 'none';
            }

            img.addEventListener("mousemove", handleMouseMove);
            lens.addEventListener("mousemove", handleMouseMove);
            img.addEventListener("touchmove", handleMouseMove);
            lens.addEventListener("touchmove", handleMouseMove);

            img.addEventListener("mouseenter", handleMouseEnter);
            lens.addEventListener("mouseenter", handleMouseEnter);

            img.addEventListener("mouseleave", handleMouseLeave);
            lens.addEventListener("mouseleave", handleMouseLeave);

            function getCursorPos(e) {
                let x = 0, y = 0;
                const a = img.getBoundingClientRect();
                e = e || window.event;

                const imgX = a.left + window.pageXOffset;
                const imgY = a.top + window.pageYOffset;

                if (e.pageX) {
                    x = e.pageX;
                    y = e.pageY;
                } else if (e.clientX) {
                    x = e.clientX + document.documentElement.scrollLeft;
                    y = e.clientY + document.documentElement.scrollTop;
                } else if (e.touches && e.touches.length > 0) {
                    x = e.touches[0].pageX;
                    y = e.touches[0].pageY;
                }

                x = x - imgX;
                y = y - imgY;

                return { x, y };
            }
        }

        // Change main image when clicking thumbnails
        function changeImage(imageUrl, element) {
            const mainImage = document.getElementById('mainImage');
            mainImage.src = imageUrl;

            // Update active thumbnail
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('active');
            });
            element.classList.add('active');

            // Reinitialize zoom
            imageZoom("mainImage", "myresult");
        }

        // Initialize zoom effect on page load
        document.addEventListener("DOMContentLoaded", function() {
            imageZoom("mainImage", "myresult");
        });

        // Quantity controls
        function decreaseQuantity() {
            const quantityInput = document.getElementById('quantity');
            let quantity = parseInt(quantityInput.value);
            if (quantity > 1) {
                quantityInput.value = quantity - 1;
                document.getElementById('cart-quantity').value = quantity - 1;
            }
        }

        function increaseQuantity() {
            const quantityInput = document.getElementById('quantity');
            let quantity = parseInt(quantityInput.value);
            quantityInput.value = quantity + 1;
            document.getElementById('cart-quantity').value = quantity + 1;
        }

        // Size selection
        document.querySelectorAll('.size-box').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.size-box').forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected');
                const size = this.getAttribute('data-size');
                document.getElementById('selected-size').value = size;
                document.getElementById('cart-size').value = size;
                document.getElementById('addToCartBtn').disabled = false;
            });
        });

        // Mobile menu toggle
        document.getElementById('mobile-menu-btn')?.addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenu) {
                mobileMenu.classList.toggle('hidden');
            }
        });
    </script>
</body>
</html>